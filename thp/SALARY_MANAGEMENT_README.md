# Há»‡ Thá»‘ng Quáº£n LÃ½ LÆ°Æ¡ng - THP App

## Tá»•ng Quan

Há»‡ thá»‘ng quáº£n lÃ½ lÆ°Æ¡ng Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘áº·c biá»‡t cho role **Káº¿ toÃ¡n** (`ke_toan`), cung cáº¥p Ä‘áº§y Ä‘á»§ chá»©c nÄƒng Ä‘á»ƒ:

1. **Quáº£n lÃ½ phÃ­ cá»‘ Ä‘á»‹nh** - CÃ i Ä‘áº·t BHXH, phá»¥ cáº¥p, kháº¥u trá»« cá»‘ Ä‘á»‹nh
2. **Táº¡o phiáº¿u lÆ°Æ¡ng** - Táº¡o vÃ  quáº£n lÃ½ phiáº¿u lÆ°Æ¡ng cho tá»«ng nhÃ¢n viÃªn
3. **Xuáº¥t Excel** - Tá»± Ä‘á»™ng xuáº¥t phiáº¿u lÆ°Æ¡ng Excel vÃ o Google Drive folder "PHIEU LUONG"

## CÃ¡c Chá»©c NÄƒng ChÃ­nh

### ğŸ¢ **Quáº£n LÃ½ PhÃ­ Cá»‘ Äá»‹nh**

#### **Loáº¡i PhÃ­ Há»— Trá»£**

- **Kháº¥u trá»«** (`deduction`) - CÃ¡c khoáº£n kháº¥u trá»« tá»« lÆ°Æ¡ng
- **Phá»¥ cáº¥p** (`allowance`) - CÃ¡c khoáº£n phá»¥ cáº¥p thÃªm vÃ o lÆ°Æ¡ng
- **Báº£o hiá»ƒm** (`insurance`) - BHXH, BHYT, BHTN

#### **TÃ­nh NÄƒng**

- âœ… ThÃªm/sá»­a/xÃ³a loáº¡i phÃ­
- âœ… CÃ i Ä‘áº·t sá»‘ tiá»n cá»‘ Ä‘á»‹nh
- âœ… Báº­t/táº¯t tráº¡ng thÃ¡i hoáº¡t Ä‘á»™ng
- âœ… MÃ´ táº£ chi tiáº¿t cho tá»«ng loáº¡i phÃ­
- âœ… Thá»‘ng kÃª theo loáº¡i phÃ­

### ğŸ“‹ **Táº¡o Phiáº¿u LÆ°Æ¡ng**

#### **ThÃ´ng Tin Tá»± Äá»™ng**

- **Chá»n nhÃ¢n viÃªn**: Tá»« danh sÃ¡ch nhÃ¢n viÃªn cÃ³ sáºµn trong há»‡ thá»‘ng
- **ThÃ¡ng/nÄƒm lÆ°Æ¡ng**: Chá»n thÃ¡ng/nÄƒm cáº§n tÃ­nh lÆ°Æ¡ng
- **LÆ°Æ¡ng cÆ¡ báº£n**: Tá»± Ä‘á»™ng láº¥y tá»« User Management
- **Sá»‘ ngÃ y lÃ m viá»‡c**: Tá»± Ä‘á»™ng láº¥y tá»« há»‡ thá»‘ng cháº¥m cÃ´ng
- **Giá» tÄƒng ca**: Tá»± Ä‘á»™ng láº¥y tá»« há»‡ thá»‘ng cháº¥m cÃ´ng

#### **TÃ­nh ToÃ¡n Tá»± Äá»™ng**

- **LÆ°Æ¡ng theo ngÃ y**: `LÆ°Æ¡ng ngÃ y Ã— Sá»‘ ngÃ y lÃ m viá»‡c`
- **LÆ°Æ¡ng tÄƒng ca**: `LÆ°Æ¡ng ngÃ y Ã— 1.5 Ã— Sá»‘ giá» tÄƒng ca`
- **Tá»•ng lÆ°Æ¡ng gá»™p**: LÆ°Æ¡ng theo ngÃ y + LÆ°Æ¡ng tÄƒng ca + Phá»¥ cáº¥p + ThÆ°á»Ÿng
- **LÆ°Æ¡ng thá»±c nháº­n**: Tá»•ng lÆ°Æ¡ng gá»™p - Kháº¥u trá»« - á»¨ng lÆ°Æ¡ng

**VÃ­ dá»¥**: LÆ°Æ¡ng ngÃ y 300k, Ä‘i 30 buá»•i, tÄƒng ca 10 giá»

- LÆ°Æ¡ng theo ngÃ y: 300k Ã— 30 = 9M
- LÆ°Æ¡ng tÄƒng ca: 300k Ã— 1.5 Ã— 10 = 4.5M
- Tá»•ng lÆ°Æ¡ng gá»™p: 9M + 4.5M = 13.5M

#### **Kháº¥u Trá»« & Phá»¥ Cáº¥p**

- **Kháº¥u trá»«**: Tá»± Ä‘á»™ng láº¥y tá»« phÃ­ cá»‘ Ä‘á»‹nh + thÃªm thá»§ cÃ´ng
- **Phá»¥ cáº¥p**: Tá»± Ä‘á»™ng láº¥y tá»« phÃ­ cá»‘ Ä‘á»‹nh + thÃªm thá»§ cÃ´ng
- **ThÆ°á»Ÿng**: ThÃªm thá»§ cÃ´ng theo tá»«ng trÆ°á»ng há»£p
- **á»¨ng lÆ°Æ¡ng**: Tá»± Ä‘á»™ng láº¥y tá»« há»‡ thá»‘ng á»©ng lÆ°Æ¡ng Ä‘Ã£ duyá»‡t

#### **TÃ­ch Há»£p Tá»± Äá»™ng**

- **User Management**: Láº¥y thÃ´ng tin nhÃ¢n viÃªn, lÆ°Æ¡ng cÆ¡ báº£n, role
- **Attendance System**: Láº¥y sá»‘ ngÃ y lÃ m viá»‡c, giá» tÄƒng ca
- **Advance Salary**: Láº¥y á»©ng lÆ°Æ¡ng Ä‘Ã£ duyá»‡t trong thÃ¡ng
- **Fixed Fees**: Ãp dá»¥ng cÃ¡c loáº¡i phÃ­ cá»‘ Ä‘á»‹nh Ä‘Ã£ cÃ i Ä‘áº·t

### ğŸ“Š **Xuáº¥t Excel Tá»± Äá»™ng**

#### **ÄÃ­ch Xuáº¥t**

- **Folder**: `PHIEU LUONG` (tá»± Ä‘á»™ng táº¡o náº¿u chÆ°a cÃ³)
- **Vá»‹ trÃ­**: Root folder Google Drive cá»§a cÃ´ng ty
- **TÃªn file**: `Phiáº¿u lÆ°Æ¡ng - [TÃªn NV] - ThÃ¡ng [X]-[NÄƒm].xlsx`

#### **Ná»™i Dung Excel**

- **Sheet 1**: ThÃ´ng tin nhÃ¢n viÃªn vÃ  thÃ¡ng lÆ°Æ¡ng
- **Sheet 2**: Chi tiáº¿t lÆ°Æ¡ng (cÆ¡ báº£n, tÄƒng ca)
- **Sheet 3**: Phá»¥ cáº¥p vÃ  thÆ°á»Ÿng
- **Sheet 4**: Kháº¥u trá»« vÃ  á»©ng lÆ°Æ¡ng
- **Sheet 5**: Tá»•ng káº¿t lÆ°Æ¡ng

## CÃ¡ch Sá»­ Dá»¥ng

### 1. **Truy Cáº­p Há»‡ Thá»‘ng**

Chá»‰ role **Káº¿ toÃ¡n** (`ke_toan`) má»›i tháº¥y menu quáº£n lÃ½ lÆ°Æ¡ng trong HomeScreen:

```javascript
{
  isAccountant && (
    <>
      <TouchableOpacity
        onPress={() => navigation.navigate('FixedFeesManagement')}
      >
        <Text>Quáº£n lÃ½ phÃ­ cá»‘ Ä‘á»‹nh</Text>
      </TouchableOpacity>

      <TouchableOpacity
        onPress={() => navigation.navigate('SalarySlipCreation')}
      >
        <Text>Táº¡o phiáº¿u lÆ°Æ¡ng</Text>
      </TouchableOpacity>
    </>
  );
}
```

### 2. **Thiáº¿t Láº­p PhÃ­ Cá»‘ Äá»‹nh**

#### **BÆ°á»›c 1: VÃ o mÃ n hÃ¬nh "Quáº£n lÃ½ phÃ­ cá»‘ Ä‘á»‹nh"**

- Nháº¥n nÃºt "+" Ä‘á»ƒ thÃªm loáº¡i phÃ­ má»›i
- Chá»n loáº¡i phÃ­: Kháº¥u trá»«, Phá»¥ cáº¥p, hoáº·c Báº£o hiá»ƒm
- Nháº­p tÃªn vÃ  sá»‘ tiá»n
- ThÃªm mÃ´ táº£ (tÃ¹y chá»n)
- Báº­t/táº¯t tráº¡ng thÃ¡i hoáº¡t Ä‘á»™ng

#### **VÃ­ dá»¥ Thiáº¿t Láº­p**

```
Kháº¥u trá»«:
- Báº£o hiá»ƒm xÃ£ há»™i: 8% lÆ°Æ¡ng cÆ¡ báº£n
- Báº£o hiá»ƒm y táº¿: 1.5% lÆ°Æ¡ng cÆ¡ báº£n
- Báº£o hiá»ƒm tháº¥t nghiá»‡p: 1% lÆ°Æ¡ng cÆ¡ báº£n

Phá»¥ cáº¥p:
- Phá»¥ cáº¥p Äƒn trÆ°a: 500,000 VNÄ/thÃ¡ng
- Phá»¥ cáº¥p xÄƒng xe: 300,000 VNÄ/thÃ¡ng
- Phá»¥ cáº¥p Ä‘iá»‡n thoáº¡i: 200,000 VNÄ/thÃ¡ng
```

### 3. **Táº¡o Phiáº¿u LÆ°Æ¡ng**

#### **BÆ°á»›c 1: Chá»n nhÃ¢n viÃªn**

- Nháº¥n vÃ o "Chá»n nhÃ¢n viÃªn"
- Chá»n tá»« danh sÃ¡ch nhÃ¢n viÃªn cÃ³ sáºµn trong há»‡ thá»‘ng
- Há»‡ thá»‘ng tá»± Ä‘á»™ng load thÃ´ng tin lÆ°Æ¡ng vÃ  cháº¥m cÃ´ng

#### **BÆ°á»›c 2: Chá»n thÃ¡ng/nÄƒm lÆ°Æ¡ng**

- Chá»n thÃ¡ng vÃ  nÄƒm cáº§n tÃ­nh lÆ°Æ¡ng
- Há»‡ thá»‘ng tá»± Ä‘á»™ng load thÃ´ng tin cháº¥m cÃ´ng cá»§a thÃ¡ng/nÄƒm Ä‘Ã³
- Hiá»ƒn thá»‹ sá»‘ ngÃ y lÃ m viá»‡c, giá» tÄƒng ca tá»± Ä‘á»™ng

#### **BÆ°á»›c 3: ThÃªm kháº¥u trá»«/phá»¥ cáº¥p**

- **Kháº¥u trá»«**: Nháº¥n nÃºt "+" mÃ u Ä‘á»
- **Phá»¥ cáº¥p**: Nháº¥n nÃºt "+" mÃ u xanh
- **ThÆ°á»Ÿng**: Nháº¥n nÃºt "+" mÃ u cam

#### **BÆ°á»›c 4: Táº¡o phiáº¿u lÆ°Æ¡ng**

- Nháº¥n "Táº¡o phiáº¿u lÆ°Æ¡ng"
- Há»‡ thá»‘ng tá»± Ä‘á»™ng:
  - Láº¥y thÃ´ng tin nhÃ¢n viÃªn tá»« User Management
  - Láº¥y thÃ´ng tin cháº¥m cÃ´ng tá»« Attendance System
  - Láº¥y á»©ng lÆ°Æ¡ng tá»« Advance Salary System
  - TÃ­nh toÃ¡n lÆ°Æ¡ng theo cÃ´ng thá»©c chuáº©n
  - LÆ°u phiáº¿u lÆ°Æ¡ng vÃ o database
- Chá»n cÃ³ xuáº¥t Excel ngay hay khÃ´ng

### 4. **Xuáº¥t Excel**

#### **Tá»± Äá»™ng Sau Khi Táº¡o**

- Sau khi táº¡o phiáº¿u lÆ°Æ¡ng thÃ nh cÃ´ng
- Há»‡ thá»‘ng há»i cÃ³ muá»‘n xuáº¥t Excel khÃ´ng
- Chá»n "CÃ³" Ä‘á»ƒ xuáº¥t ngay

#### **Xuáº¥t Thá»§ CÃ´ng**

- VÃ o danh sÃ¡ch phiáº¿u lÆ°Æ¡ng
- Chá»n phiáº¿u cáº§n xuáº¥t
- Nháº¥n nÃºt "Xuáº¥t Excel"

## Cáº¥u TrÃºc Dá»¯ Liá»‡u

### **FixedFees Collection**

```javascript
{
  id: "fee_id",
  name: "Báº£o hiá»ƒm xÃ£ há»™i",
  type: "insurance", // deduction | allowance | insurance
  amount: 500000,
  description: "8% lÆ°Æ¡ng cÆ¡ báº£n",
  isActive: true,
  createdAt: timestamp,
  updatedAt: timestamp,
  createdBy: "user_id"
}
```

### **SalarySlips Collection**

```javascript
{
  id: "salary_id",
  employeeId: "emp_id",
  employeeName: "Nguyá»…n VÄƒn A",
  month: 12,
  year: 2024,
  basicSalary: 15000000,
  workingDays: 22,
  overtimeHours: 8,
  deductions: [
    { name: "BHXH", amount: 1200000 },
    { name: "BHYT", amount: 225000 }
  ],
  allowances: [
    { name: "Phá»¥ cáº¥p Äƒn trÆ°a", amount: 500000 }
  ],
  bonuses: [
    { name: "ThÆ°á»Ÿng cuá»‘i nÄƒm", amount: 2000000 }
  ],
  advancePayments: [
    { reason: "á»¨ng lÆ°Æ¡ng thÃ¡ng 11", amount: 3000000 }
  ],
  calculatedSalary: {
    dailySalary: 576923,
    salaryByDays: 12692306,
    overtimeSalary: 865385,
    totalAllowances: 500000,
    totalBonuses: 2000000,
    totalDeductions: 1425000,
    totalAdvancePayments: 3000000,
    grossSalary: 16057691,
    netSalary: 11632691
  },
  status: "pending", // pending | approved | paid | exported
  notes: "Phiáº¿u lÆ°Æ¡ng thÃ¡ng 12/2024",
  excelFileId: "drive_file_id",
  excelFileName: "Phiáº¿u lÆ°Æ¡ng - Nguyá»…n VÄƒn A - ThÃ¡ng 12-2024.xlsx",
  excelFileUrl: "https://drive.google.com/...",
  exportedAt: timestamp,
  createdAt: timestamp,
  updatedAt: timestamp,
  createdBy: "user_id"
}
```

## Cloud Functions

### **exportSalarySlipToDrive**

- **Chá»©c nÄƒng**: Xuáº¥t phiáº¿u lÆ°Æ¡ng Excel vÃ o Google Drive
- **Input**: `salarySlipId`, `accessToken`
- **Output**: File Excel trong folder "PHIEU LUONG"
- **Xá»­ lÃ½**: Táº¡o Excel vá»›i 5 sheet, upload vÃ o Drive

### **exportMultipleSalarySlips**

- **Chá»©c nÄƒng**: Xuáº¥t nhiá»u phiáº¿u lÆ°Æ¡ng cÃ¹ng lÃºc
- **Input**: `salarySlipIds[]`, `accessToken`, `month`, `year`
- **Output**: Nhiá»u file Excel
- **Xá»­ lÃ½**: Batch export cho tá»«ng phiáº¿u lÆ°Æ¡ng

## TÃ­ch Há»£p Google Drive

### **Folder Structure**

```
Root Folder (1Ci_BHZx0-Uhv2xg5IzwLPn05yPAUXOOU)
â”œâ”€â”€ Thá»‘ng kÃª váº­t tÆ°/
â”œâ”€â”€ PHIEU LUONG/          â† Tá»± Ä‘á»™ng táº¡o
â”‚   â”œâ”€â”€ Phiáº¿u lÆ°Æ¡ng - NV A - ThÃ¡ng 12-2024.xlsx
â”‚   â”œâ”€â”€ Phiáº¿u lÆ°Æ¡ng - NV B - ThÃ¡ng 12-2024.xlsx
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### **File Naming Convention**

```
Phiáº¿u lÆ°Æ¡ng - [TÃªn NhÃ¢n ViÃªn] - ThÃ¡ng [X]-[NÄƒm].xlsx

VÃ­ dá»¥:
- Phiáº¿u lÆ°Æ¡ng - Nguyá»…n VÄƒn A - ThÃ¡ng 12-2024.xlsx
- Phiáº¿u lÆ°Æ¡ng - Tráº§n Thá»‹ B - ThÃ¡ng 1-2025.xlsx
```

## Quyá»n Truy Cáº­p

### **Role-Based Access**

- **Káº¿ toÃ¡n** (`ke_toan`): ToÃ n quyá»n truy cáº­p
- **CÃ¡c role khÃ¡c**: KhÃ´ng tháº¥y menu quáº£n lÃ½ lÆ°Æ¡ng

### **Google Drive Permissions**

- Cáº§n Ä‘Äƒng nháº­p Google Signin
- Cáº§n access token Ä‘á»ƒ upload file
- Tá»± Ä‘á»™ng táº¡o folder náº¿u chÆ°a cÃ³

## Lá»£i Ãch

### 1. **Tá»± Äá»™ng HÃ³a**

- TÃ­nh toÃ¡n lÆ°Æ¡ng tá»± Ä‘á»™ng
- Xuáº¥t Excel tá»± Ä‘á»™ng vÃ o Drive
- KhÃ´ng cáº§n copy/paste thá»§ cÃ´ng

### 2. **ChÃ­nh XÃ¡c**

- CÃ´ng thá»©c tÃ­nh lÆ°Æ¡ng chuáº©n
- Tá»± Ä‘á»™ng láº¥y á»©ng lÆ°Æ¡ng tá»« há»‡ thá»‘ng
- KhÃ´ng cÃ³ lá»—i tÃ­nh toÃ¡n

### 3. **Quáº£n LÃ½ Táº­p Trung**

- Táº¥t cáº£ phÃ­ cá»‘ Ä‘á»‹nh á»Ÿ má»™t nÆ¡i
- Lá»‹ch sá»­ phiáº¿u lÆ°Æ¡ng Ä‘áº§y Ä‘á»§
- Dá»… dÃ ng tra cá»©u vÃ  bÃ¡o cÃ¡o

### 4. **TÃ­ch Há»£p HoÃ n Chá»‰nh**

- Káº¿t ná»‘i vá»›i há»‡ thá»‘ng cháº¥m cÃ´ng
- Káº¿t ná»‘i vá»›i há»‡ thá»‘ng á»©ng lÆ°Æ¡ng
- Xuáº¥t Excel vÃ o Google Drive

## Troubleshooting

### **Lá»—i ThÆ°á»ng Gáº·p**

#### **1. KhÃ´ng thá»ƒ xuáº¥t Excel**

- Kiá»ƒm tra Google Signin Ä‘Ã£ Ä‘Äƒng nháº­p chÆ°a
- Kiá»ƒm tra quyá»n truy cáº­p Google Drive
- Kiá»ƒm tra káº¿t ná»‘i internet

#### **2. TÃ­nh lÆ°Æ¡ng sai**

- Kiá»ƒm tra lÆ°Æ¡ng cÆ¡ báº£n cÃ³ Ä‘Ãºng khÃ´ng
- Kiá»ƒm tra sá»‘ ngÃ y lÃ m viá»‡c
- Kiá»ƒm tra cÃ¡c khoáº£n kháº¥u trá»«/phá»¥ cáº¥p

#### **3. KhÃ´ng tháº¥y menu quáº£n lÃ½ lÆ°Æ¡ng**

- Kiá»ƒm tra role cÃ³ pháº£i `ke_toan` khÃ´ng
- Kiá»ƒm tra Ä‘Ã£ Ä‘Äƒng nháº­p thÃ nh cÃ´ng chÆ°a
- Refresh láº¡i HomeScreen

### **Debug Tips**

```javascript
// Kiá»ƒm tra role user
console.log('User role:', user?.role);

// Kiá»ƒm tra quyá»n truy cáº­p
console.log('Can access salary management:', isAccountant);

// Kiá»ƒm tra Google Signin
const tokens = await GoogleSignin.getTokens();
console.log('Google tokens:', tokens);
```

## TÆ°Æ¡ng Lai

### **TÃ­nh NÄƒng CÃ³ Thá»ƒ ThÃªm**

1. **Batch Processing**: Xá»­ lÃ½ hÃ ng loáº¡t phiáº¿u lÆ°Æ¡ng
2. **Salary Templates**: Template sáºµn cÃ³ cho tá»«ng vá»‹ trÃ­
3. **Auto Calculation**: Tá»± Ä‘á»™ng tÃ­nh lÆ°Æ¡ng theo thá»i gian
4. **Salary Reports**: BÃ¡o cÃ¡o tá»•ng há»£p lÆ°Æ¡ng
5. **Tax Calculation**: TÃ­nh thuáº¿ thu nháº­p cÃ¡ nhÃ¢n
6. **Bank Integration**: Chuyá»ƒn lÆ°Æ¡ng tá»± Ä‘á»™ng

### **TÃ­ch Há»£p NÃ¢ng Cao**

1. **ERP Systems**: Káº¿t ná»‘i vá»›i há»‡ thá»‘ng ERP
2. **Accounting Software**: TÃ­ch há»£p pháº§n má»m káº¿ toÃ¡n
3. **Mobile App**: á»¨ng dá»¥ng mobile cho nhÃ¢n viÃªn
4. **API Integration**: API cho bÃªn thá»© 3

## Káº¿t Luáº­n

Há»‡ thá»‘ng quáº£n lÃ½ lÆ°Æ¡ng cung cáº¥p giáº£i phÃ¡p toÃ n diá»‡n cho káº¿ toÃ¡n:

- âœ… **Dá»… sá»­ dá»¥ng**: Giao diá»‡n thÃ¢n thiá»‡n, thao tÃ¡c Ä‘Æ¡n giáº£n
- âœ… **Tá»± Ä‘á»™ng hÃ³a**: TÃ­nh toÃ¡n vÃ  xuáº¥t Excel tá»± Ä‘á»™ng
- âœ… **ChÃ­nh xÃ¡c**: CÃ´ng thá»©c tÃ­nh lÆ°Æ¡ng chuáº©n, khÃ´ng cÃ³ lá»—i
- âœ… **TÃ­ch há»£p**: Káº¿t ná»‘i vá»›i cÃ¡c há»‡ thá»‘ng khÃ¡c
- âœ… **Báº£o máº­t**: Chá»‰ káº¿ toÃ¡n má»›i cÃ³ quyá»n truy cáº­p
- âœ… **Linh hoáº¡t**: TÃ¹y chá»‰nh theo nhu cáº§u cÃ´ng ty

Vá»›i há»‡ thá»‘ng nÃ y, káº¿ toÃ¡n cÃ³ thá»ƒ quáº£n lÃ½ lÆ°Æ¡ng má»™t cÃ¡ch hiá»‡u quáº£, chÃ­nh xÃ¡c vÃ  tiáº¿t kiá»‡m thá»i gian Ä‘Ã¡ng ká»ƒ.
